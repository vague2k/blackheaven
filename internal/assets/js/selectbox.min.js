(()=>{(function(){let b=!1;function S(a){if(!a||a.hasAttribute("data-initialized"))return;a.setAttribute("data-initialized","true");let s=a.querySelector("button.select-trigger");if(!s){console.error("Select box: Trigger button (.select-trigger) not found in wrapper",a);return}let m=s.dataset.contentId,w=s.dataset.multiple==="true",A=s.dataset.showPills==="true",x=m?document.getElementById(m):null,n=s.querySelector(".select-value"),d=s.querySelector('input[type="hidden"]');if(!x||!n||!d){console.error("Select box: Missing required elements for initialization.",{wrapper:a,contentID:m,contentExists:!!x,valueElExists:!!n,hiddenInputExists:!!d});return}s.addEventListener("keydown",e=>{(e.key.length===1||e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),document.getElementById(m).click(),setTimeout(()=>{let t=document.querySelector("[data-select-search]");t&&(t.focus(),e.key!=="Backspace"&&e.key!=="Delete"&&(t.value=e.key))},0))});let o=x.cloneNode(!0);x.parentNode.replaceChild(o,x);let h=o.querySelector("[data-select-search]");if(h){let e=()=>{let t=window.getComputedStyle(o);t.display!=="none"&&t.visibility!=="hidden"&&t.opacity!=="0"&&h.focus()};document.addEventListener("click",t=>{s.contains(t.target)&&setTimeout(e,50)}),s.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&setTimeout(e,50)}),h.addEventListener("input",t=>{let l=t.target.value.toLowerCase().trim();o.querySelectorAll(".select-item").forEach(c=>{let u=c.querySelector(".select-item-text")?.textContent.toLowerCase()||"",i=c.getAttribute("data-value")?.toLowerCase()||"",p=l===""||u.includes(l)||i.includes(l);c.style.display=p?"":"none"})})}o.addEventListener("keydown",e=>{if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();let t=Array.from(o.querySelectorAll(".select-item")).filter(c=>c.style.display!=="none");if(t.length===0)return;let l=o.querySelector(".select-item:focus"),r=0;if(l){let c=t.indexOf(l);e.key==="ArrowDown"?r=(c+1)%t.length:r=(c-1+t.length)%t.length}t[r].focus()}else if(e.key==="Enter"){e.preventDefault();let t=o.querySelector(".select-item:focus");t&&v(t)}else e.key==="Escape"&&(e.preventDefault(),o.querySelector(".select-item:focus")?h.focus():document.activeElement===h&&window.closePopover&&(window.closePopover(m,!0),setTimeout(()=>{s.focus()},50)))});let f=o.querySelectorAll('.select-item[data-selected="true"]');if(f.length>0)if(w){if(A){n.innerHTML="";let t=document.createElement("div");t.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(f).forEach(l=>{let r=document.createElement("div");r.className="flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-primary text-primary-foreground";let c=document.createElement("span");c.textContent=l.querySelector(".select-item-text").textContent;let u=document.createElement("button");u.className="hover:text-destructive focus:outline-none",u.innerHTML="x",u.onclick=i=>{i.stopPropagation(),v(l)},r.appendChild(c),r.appendChild(u),t.appendChild(r)}),n.appendChild(t),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let l=t.scrollWidth,r=n.clientWidth;if(l>r){let u=(s.dataset.selectedCountText||`${f.length} items selected`).replace("{n}",f.length);n.innerHTML=u,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${f.length} items selected`,n.classList.remove("text-muted-foreground");let e=Array.from(f).map(t=>t.getAttribute("data-value"));d.value=e.join(",")}else{let e=f[0],t=e.querySelector(".select-item-text");if(t&&(n.textContent=t.textContent,n.classList.remove("text-muted-foreground")),d){let l=e.getAttribute("data-value")||"";d.hasAttribute("data-initialized")||(d.value=l,d.setAttribute("data-initialized","true"),d.dispatchEvent(new Event("change",{bubbles:!0})))}}function k(){o.querySelectorAll(".select-item").forEach(e=>{e.getAttribute("data-selected")==="true"?(e.classList.add("bg-accent","text-accent-foreground"),e.classList.remove("bg-muted")):e.classList.remove("bg-accent","text-accent-foreground","bg-muted")})}function v(e){if(!e||e.getAttribute("data-disabled")==="true"||b)return;b=!0;let t=e.getAttribute("data-value"),l=e.querySelector(".select-item-text");if(w){let r=e.getAttribute("data-selected")==="true";if(e.setAttribute("data-selected",(!r).toString()),r){e.classList.remove("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-100","opacity-0")}else{e.classList.add("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-0","opacity-100")}let c=o.querySelectorAll('.select-item[data-selected="true"]');if(c.length>0)if(A){n.innerHTML="";let i=document.createElement("div");i.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(c).forEach(p=>{let g=document.createElement("div");g.className="flex items-center gap-1 px-2 py-0.5 text-xs rounded-full bg-accent text-accent-foreground";let L=document.createElement("span");L.textContent=p.querySelector(".select-item-text").textContent;let y=document.createElement("button");y.className="hover:text-destructive focus:outline-none",y.innerHTML="\xD7",y.onclick=q=>{q.stopPropagation(),v(p)},g.appendChild(L),g.appendChild(y),i.appendChild(g)}),n.appendChild(i),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let p=i.scrollWidth,g=n.clientWidth;if(p>g){let y=(s.dataset.selectedCountText||`${c.length} items selected`).replace("{n}",c.length);n.innerHTML=y,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${c.length} items selected`,n.classList.remove("text-muted-foreground");else n.textContent=n.getAttribute("data-placeholder")||"",n.classList.add("text-muted-foreground");let u=Array.from(c).map(i=>i.getAttribute("data-value"));d.value=u.join(","),d.dispatchEvent(new Event("change",{bubbles:!0}))}else{o.querySelectorAll(".select-item").forEach(c=>{c.setAttribute("data-selected","false"),c.classList.remove("bg-accent","text-accent-foreground","bg-muted");let u=c.querySelector(".select-check");u&&u.classList.replace("opacity-100","opacity-0")}),e.setAttribute("data-selected","true"),e.classList.add("bg-accent","text-accent-foreground");let r=e.querySelector(".select-check");if(r&&r.classList.replace("opacity-0","opacity-100"),n&&l&&(n.textContent=l.textContent,n.classList.remove("text-muted-foreground")),d&&t!==null){let c=d.value;d.value=t,c!==t&&d.dispatchEvent(new Event("change",{bubbles:!0}))}window.closePopover?(window.closePopover(m,!0),setTimeout(()=>{s.focus()},50)):console.warn("closePopover function not found")}setTimeout(()=>{b=!1},100)}o.addEventListener("click",e=>{let t=e.target.closest(".select-item");t&&v(t)}),o.addEventListener("keydown",e=>{let t=e.target.closest(".select-item");t&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),v(t))}),o.addEventListener("mouseover",e=>{let t=e.target.closest(".select-item");!t||t.getAttribute("data-disabled")==="true"||(o.querySelectorAll(".select-item").forEach(l=>{l.classList.remove("bg-accent","text-accent-foreground","bg-muted")}),t.getAttribute("data-selected")!=="true"&&t.classList.add("bg-accent","text-accent-foreground"))}),o.addEventListener("mouseleave",k)}function E(a=document){a.querySelectorAll(".select-container").forEach(S)}let C=a=>{let s;a.type==="htmx:afterSwap"&&(s=a.detail.elt),a.type==="htmx:oobAfterSwap"&&(s=a.detail.target),s instanceof Element&&requestAnimationFrame(()=>E(s))};document.body.addEventListener("htmx:afterSwap",a=>{C(a)}),E(),document.addEventListener("DOMContentLoaded",()=>E())})();})();
